@page "/sessions"
@using RevXPortal.Models
@*@attribute [Authorize]*@

<style>
    .grid {
        border: solid 1px #626263;
        border-radius: 4.5px;
        text-align: center;
        margin: 1rem;
        height: 75vh;
        overflow: hidden;
    }

    th {
        font-size: 1.3rem;
    }

    .d-flex {
        align-items: baseline;
    }

    .icon {
        font-size: 1rem;
    }

    .custom-select:focus {
        box-shadow: none;
    }

    .valid.modified:not([type=checkbox]) {
        outline: none;
        border: solid 1px #26b050;
    }

    .modal {
        background-color: rgb(0 0 0 / 0.70)
    }

    .fade-in {
        animation: fade-in;
        animation-duration: .6s;
    }

    .form-group > label {
        margin-bottom: 0;
    }

    td > .btn {
        padding: 0;
    }
</style>

<div class="d-flex justify-content-between">
    <h3>Sessions</h3>

    <button class="btn btn-primary" @onclick="ShowDialog">Add Session</button>
</div>

<div class="grid">
    <table class="table table-bordered table-striped" style="margin-top: -1px">
        <thead>
            <tr>
                @if (sessions.Count > 0)
                {
                    <th></th>
                }
                <th>Student</th>
                <th>Date</th>
                <th>Start Time</th>
                <th>End Time</th>
                <th>Provider</th>
                <th>Billing Status</th>
                <th>Notes</th>
            </tr>
        </thead>

        @if (sessions.Count > 0)
        {
            <tbody>
                @foreach (var session in sessions)
                {
                    <tr>
                        <td class=""><button type="button" class="btn btn-outline" @onclick="(() => Edit(session))"><i class="oi oi-trash icon"></i></button></td>
                        <td>@session.Student.FullName</td>
                        <td>@session.Date.ToShortDateString()</td>
                        <td>@session.StartTime</td>
                        <td>@session.EndTime</td>
                        <td>@session.Provider</td>
                        <td>@session.BillingStatus</td>
                        <td>@session.Notes</td>
                    </tr>
                }
            </tbody>
        }
    </table>


    @* Main Row if sessions is empty *@
    @if (sessions.Count == 0)
    {
        <div class="empty-table-cell grid-cell">
            <h4>Please <a href="#">click here</a> to enter a session</h4>
        </div>
    }
</div>

<FormModal @ref="FormModalRef" FormSession="ManageSession" SaveForm="SaveForm"></FormModal>




@code {
    private FormModal FormModalRef { get; set; }
    public ManageSessionModel ManageSession { get; set; }

    private List<StudentModel> availableStudents = new()
    {
        new StudentModel() { FirstName = "Duvi", LastName = "Schwartz" },
        new StudentModel() { FirstName = "Mendy", LastName = "Surkis" },
        new StudentModel() { FirstName = "Shaya", LastName = "Spitzer" }
    };

    private List<DisplaySessionModel> sessions { get; set; }

    protected override Task OnInitializedAsync()
    {
        sessions = new();
        sessions.Add(new DisplaySessionModel
        {
            Student = availableStudents[0],
            Date = DateTime.Now,
            StartTime = new TimeSpan(1, 00, 00),
            EndTime = new TimeSpan(4, 00, 00),
            Provider = "Legadel",
            BillingStatus = "Open",
            Notes = "I was very tired!!"
        });
        sessions.Add(new DisplaySessionModel
        {
            Student = availableStudents[1],
            Date = DateTime.Now.AddDays(2),
            StartTime = new TimeSpan(10, 00, 00),
            EndTime = new TimeSpan(12, 00, 00),
            Provider = "Encore",
            BillingStatus = "Open",
            Notes = "I still am..."
        });
        return Task.CompletedTask;
    }


    private void SaveForm()
    {
        Console.WriteLine(ManageSession.Student.FirstName);
        Console.WriteLine(ManageSession.Student.LastName);
        Console.WriteLine(ManageSession.Date);
        Console.WriteLine(ManageSession.StartTime);
        Console.WriteLine(ManageSession.EndTime);
        Console.WriteLine(ManageSession.Provider);
        Console.WriteLine(ManageSession.BillingStatus);

        ManageSession = new();

        FormModalRef.Hide();
    }

    private void ShowDialog()
    {
        ManageSession = new()
        {
            Student = new StudentModel() { FirstName = "Duvi", LastName = "Schwartz"}
        };
        FormModalRef.Show();
    }

    private void Edit(DisplaySessionModel session) => EditSession(session);

    private void EditSession(DisplaySessionModel session)
    {
        ManageSession = new()
        {
            Student = session.Student,
            Date = session.Date,
            StartTime = session.StartTime.ToString(),
            EndTime = session.EndTime.ToString(),
            Provider = session.Provider,
            BillingStatus = session.BillingStatus,
            Notes = session.Notes
        };

        FormModalRef.Show();
    }


}
